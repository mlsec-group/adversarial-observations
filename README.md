# Adversarial Observations in Weather Forecasting

This repository contains the code used for the publication "Adversarial Observations in Weather Forecasting". You can reproduce our results using the code in this repository. It also contains our forked variant of the [GenCast package](https://github.com/google-deepmind/graphcast).

## Dependencies

We package all dependencies in an [apptainer](https://apptainer.org/) image for ease of reproduction. You can build the package using
> apptainer build container.sif container.def

and then start an interactive session (with support for Nvidia CUDA) using
> apptainer run --nv container.sif bash

We assume that all scripts are executed in this environment.

## Data

Full evaluation requires downloading the
[ERA5](https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5)
dataset, available from [ECMWF](https://www.ecmwf.int/). This can best be
accessed as Zarr from [Weatherbench2's ERA5 data](https://weatherbench2.readthedocs.io/en/latest/data-guide.html#era5). For your convenience, you can simply run the following command in the apptainer to download the data required for evaluation.

> python3 cache_era5.py

The target locations are computed using [GHS-UCDB R2024A](https://human-settlement.emergency.copernicus.eu/ghs_ucdb_2024.php). To ease exact reproduction, we provide the random locations and times chosen by us at `data/weather_evaluation_targets.json`. Alternatively, a new list can be generated by
> python3 generate_weather_targets.py

The variance in the weather variables is estimated by running
> python3 estimate_error_variance.py

## Preliminary Study

In addition to the experiments described in the paper, we provide a notebook that shows several ablations of our attack on a single example target and variable in `preliminary_study.ipynb`.

## Evaluation of fabricating extreme wheather predictions

We assume that all data from the previous section is set up. In that case, you can run the evaluation using the following commands:
> python3 evaluate.py --epsilons 0.02 0.03 0.04 0.05 0.07 --target=wind

> python3 evaluate.py --epsilons 0.02 0.03 0.04 0.05 0.07 --target=temperature

> python3 evaluate.py --epsilons 0.02 0.03 0.04 0.05 0.07 --target=precipitation

The results can then be evaluated using the notebook `plot_results.ipynb`, which reproduces all results, including the evaluation of the detectability.

## Ablation study
> python3 evaluate.py --epsilons 0.03 0.05 --offset 0 --locations 34 --target=wind

> python3 evaluate.py --epsilons 0.03 0.05 --offset 34 --locations 34 --target=temperature

> python3 evaluate.py --epsilons 0.03 0.05 --offset 68 --locations 32 --target=precipitation

The results can then be evaluated using the notebook `plot_results.ipynb`, which reproduces all results, including the evaluation of the detectability.

## Case Studies on manipulating extreme weather predictions

The case studies are realized as the following Jupyter Notebooks:
- `case_study_heat.ipynb`
- `case_study_wind.ipynb`
- `case_study_rain.ipynb`

Each notebook shows plots inline and also produces an svg file matching the graphic in the paper.

## License and Disclaimers

The used model weights were made available for use under the terms of the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0). You may obtain a copy of the License at: https://creativecommons.org/licenses/by-nc-sa/4.0/.

Unless required by applicable law or agreed to in writing, all software and materials distributed here under the Apache 2.0 or CC-BY-NC-SA 4.0 licenses are distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the licenses for the specific language governing permissions and limitations under those licenses.

The attacks on weather models described here are part of an experimental research project. You are solely responsible for determining the appropriateness of using or distributing the attacks or any outputs generated and assume all risks associated with your use or distribution of this code and outputs and your exercise of rights and permissions granted to you under the relevant License.

The evaluation of the attacks uses ECMWF's ERA5 data.
Data and products of the European Centre for Medium-range Weather Forecasts (ECMWF).
Modified Copernicus Climate Change Service information 2023. Neither the European Commission nor ECMWF is responsible for any use that may be made of the Copernicus information or data it contains.
ECMWF HRES datasets
Copyright statement: Copyright "Â© 2023 European Centre for Medium-Range Weather Forecasts (ECMWF)".
Source: www.ecmwf.int
License Statement: ECMWF open data is published under a Creative Commons Attribution 4.0 International (CC BY 4.0). https://creativecommons.org/licenses/by/4.0/
Disclaimer: ECMWF does not accept any liability whatsoever for any error or omission in the data, their availability, or for any loss or damage arising from their use.

Use of the third-party materials referred to above may be governed by separate terms and conditions or license provisions. Your use of the third-party materials is subject to any such terms and you should check that you can comply with any applicable restrictions or terms and conditions before use.

The original GenCast and GraphCast code is licensed under the Apache License, Version 2.0. You may obtain a copy of the License at: https://www.apache.org/licenses/LICENSE-2.0.
